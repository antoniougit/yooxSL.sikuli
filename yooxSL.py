import csv
#from datetime import datetime
#from datetime import timedelta
Settings.AutoDetectKeyboardLayout = False
popup("Make sure the content is saved as \\Downloads\\sl.csv before proceeding!")
motherCampaign = input("Please enter Mother Campaign Name:")
motherCampaign = "".join(motherCampaign.split())
campaignName = input("Please enter Variant Name:")
campaignName = "".join(campaignName.split())
campaignLang = campaignName.split("_")[-1]
if "UK" in campaignLang:
    campaignLang = "OTEU"
campaignPhase = select("Please select Campaign Phase:", options = ("Exploration", "Broadcast"))
scheduleMonth = campaignName.split("_")[0]
scheduleMonth = scheduleMonth[2:4]
audienceFilter = input("Please enter Audience Filter:")
audienceFilter = "".join(audienceFilter.split())
scheduleTime = input("Please enter Schedule Time:")
scheduleTime = " ".join(scheduleTime.lower().split()[:2])
variantContent = []

with open("C:\\Users\\gantoniou\\Downloads\\sl.csv", 'rb') as csvfile:
    reader = csv.reader(csvfile, delimiter=",")
    next(reader, None)  
    for row in reader:
        if not "".join(row[1]).strip():
            continue
        else:
            variantContent.append(row[1].decode("utf-8"))
variantContent.insert(0, variantContent.pop())

variantNum = len(variantContent)
click("1633679365342.png")
sleep(0.1)
popup("Select the folder where the Mother Campaign is, make sure " + audienceFilter + " is running, and press OK to proceed!")

for i in range(variantNum):
    if i == 0:
        variantName = "ctrl"
    else: 
        variantName = "v" + str(i)
    sleep(5)
    type("f", KeyModifier.CTRL)
    type(Key.BACKSPACE)
    paste(motherCampaign)
    sleep(0.2)
    click(Pattern("1633679419307.png").targetOffset(45,0))
    sleep(0.2)
    click("1633679487424.png")
    wait("1631797190821.png",10)
    click("1631797216089.png")
    type("a", KeyModifier.CTRL)
    type(Key.BACKSPACE)
    paste(campaignName + "_" + variantName)
    click(Pattern("1631797190821.png").targetOffset(-28,0))
    wait("1631797413797.png",20)
    mouseMove(Location(600, 400))
    sleep(0.2)
    click("1631797568973.png")
    wait(Pattern("1631816776082.png").exact(),10)
    sleep(1)
    click(Pattern("1631816814116.png").similar(0.98).targetOffset(37,0))
    sleep(0.5)
    type("a", KeyModifier.CTRL)
    type(Key.BACKSPACE)
    paste(variantContent[i])
    click("1631797726196.png")
    wait("1631797413797.png",20)
    sleep(1)
    click("1631800193147.png")
    sleep(0.2)
    click("1631800217517.png")
    wait("1631800253853.png",20)
    popup("Select PERSADO_Prooflist_" + campaignLang)
    sleep(10)
    sleep(0.2)
    click(Pattern("1631800520321.png").similar(0.90))
    type("a", KeyModifier.CTRL)
    type(Key.BACKSPACE)
    paste("50")
    click("1631800565239.png")
    wait("1631800621890.png",20)
    sleep(2)
    click(Pattern("1631819153457.png").targetOffset(488,0))
    sleep(1)
    click(Pattern("1631819633918.png").similar(0.80).targetOffset(69,2))
    sleep(0.5)
    click(Pattern("1631800732674.png").exact().targetOffset(32,0))
    sleep(1)
    wait("1631815986133.png",10)
    click("1631800827544.png")
    wait("1637834117350.png",20)
type("f", KeyModifier.CTRL)
type(Key.BACKSPACE)
paste("PERSADO_COMPONENTS")
click("1631872081064.png")
sleep(0.5)
click(Pattern("1631864316748.png").exact())
wait(Pattern("1631693033057.png").similar(0.90).targetOffset(20,0),20)
click(Pattern("1631693033057.png").similar(0.90).targetOffset(20,0))
sleep(0.1)
click(Pattern("1631693144425.png").targetOffset(0,11))
sleep(0.2)
click(Pattern("1631864369361.png").similar(0.80))
type("a", KeyModifier.CTRL)
type(Key.BACKSPACE)
paste(campaignName)
click("1631693633403.png")
type(Key.BACKSPACE)
paste("PERSADO_CAMPAIGNS_2021_" + scheduleMonth)
click(Pattern("1631712731221.png").targetOffset(0,6))
sleep(5)
if variantNum == 3:
    click(Pattern("1631872326210.png").similar(0.97))
    keyDown(Key.CTRL)
    click(Pattern("1631872341881.png").similar(0.97))
    click(Pattern("1631872357392.png").similar(0.97))
    click(Pattern("1631872437653.png").similar(0.97))
    click(Pattern("1631872388897.png").similar(0.97))
    while not exists(Pattern("1631872454203.png").similar(0.97),1):
        keyUp()
        type(Key.PAGE_DOWN)
        sleep(0.1)
        keyDown(Key.CTRL)
    click(Pattern("1631872454203.png").similar(0.97))
    keyUp()
    type(Key.DELETE)
    click(Pattern("1631545019382.png").similar(0.90))
    sleep(0.2)
    if campaignPhase == "Exploration":
        split = (34, 33, 33)
    else:
        split = (10, 45, 45)
elif variantNum == 4:
    click(Pattern("1631872341881.png").similar(0.97))
    keyDown(Key.CTRL)
    click(Pattern("1631872357392.png").similar(0.97))
    click(Pattern("1631872437653.png").similar(0.97))
    click(Pattern("1631872388897.png").similar(0.97))
    while not exists(Pattern("1631872454203.png").similar(0.97),1):
        keyUp()
        type(Key.PAGE_DOWN)
        sleep(0.1)
        keyDown(Key.CTRL)
    click(Pattern("1631872454203.png").similar(0.97))
    keyUp()
    type(Key.DELETE)
    click(Pattern("1631545019382.png").similar(0.90))
    sleep(0.2)
    if campaignPhase == "Exploration":
        split = (25, 25, 25, 25)
    else:
        split = (10, 30, 30, 30)
elif variantNum == 5:
    click(Pattern("1631872357392.png").similar(0.97))
    keyDown(Key.CTRL)
    click(Pattern("1631872437653.png").similar(0.97))
    click(Pattern("1631872388897.png").similar(0.97))
    while not exists(Pattern("1631872454203.png").similar(0.97),1):
        keyUp()
        type(Key.PAGE_DOWN)
        sleep(0.1)
        keyDown(Key.CTRL)
    click(Pattern("1631872454203.png").similar(0.97))
    keyUp()
    type(Key.DELETE)
    click(Pattern("1631545019382.png").similar(0.90))
    sleep(0.2)
    if campaignPhase == "Exploration":
        split = (20, 20, 20, 20, 20)
    else:
        split = (10, 22.5, 22.5, 22.5, 22.5)
else:
    split = (12, 11, 11, 11, 11, 11, 11, 11, 11)
sleep(0.2)
doubleClick(Pattern("1631541637052.png").similar(0.90))
wait(Pattern("1631541732012.png").similar(0.90))
click(Pattern("1631541732012.png").similar(0.90).targetOffset(40,0))
type("a", KeyModifier.CTRL)
type(Key.BACKSPACE)
for i in range(variantNum):
    paste(str(split[i]))
    type(Key.TAB)
click("1631262265870.png")
sleep(0.2)
doubleClick(Pattern("1631877277473.png").exact())
wait("1631877302621.png")
click(Pattern("1631877302621.png").targetOffset(50,0))
sleep(0.2)
click(Pattern("1631877516862.png").similar(0.90))
sleep(1)
type("f", KeyModifier.CTRL)
type(Key.BACKSPACE)
paste(audienceFilter)
click(Pattern("1632387728899.png").similar(0.90))
sleep(0.2)
click(Pattern("1631877675248.png").exact())
sleep(0.2)
click(Pattern("1631864650620.png").similar(0.80).targetOffset(22,0))
type("a", KeyModifier.CTRL)
type(Key.BACKSPACE)
paste(scheduleTime)
click("1631262265870.png")
sleep(0.2)
click(Pattern("1631693033057.png").similar(0.90))
wait("1631708732619.png")
popup("Configuration READY! Please change dates, select variant per app and save!")
